<div class="gifts-container">
  <div class="view-controls">
    <h2 class="list-title">{{ displayName }}</h2>
    <button (click)="toggleViewMode()"
      [matTooltip]="viewMode === 'grid' ? 'Switch to list view' : 'Switch to grid view'" mat-icon-button>
      <mat-icon>{{ viewMode === 'grid' ? 'view_list' : 'grid_view' }}</mat-icon>
    </button>
  </div>

  @if (gifts.length === 0) {
  <div class="empty-state">
    <mat-icon class="empty-icon">card_giftcard</mat-icon>
    @if (currentFriendId) {
    <h2>No Gifts Yet</h2>
    <p>This friend hasn't added any gifts to their wishlist yet.</p>
    } @else {
    <h2>No Gifts Yet</h2>
    <p>Start building your wishlist by adding your first gift!</p>
    <button mat-raised-button color="primary" (click)="openAddGiftDialog()" class="cta-button">
      <mat-icon>add_circle</mat-icon>
      Add Your First Gift
    </button>
    }
  </div>
  } @else {
  @if (viewMode === 'grid') {
  <div class="grid-container">
    @for (gift of gifts; track gift.id) {
    <div class="grid-item">
      <mat-card class="gift-card">
        @if (currentFriendId && gift.purchased) {
        <div class="purchased-badge">
          <mat-icon>shopping_cart</mat-icon>
          <span>Purchased</span>
        </div>
        }
        <div class="card-content">
          <div class="image-container">
            <img [src]="gift.imageUrl" [alt]="gift.name" class="gift-image">
          </div>
          <div class="gift-details">
            <div class="gift-header">
              <h3 class="gift-name">{{ gift.name }}</h3>
            </div>
            <p class="gift-description">{{ gift.description }}</p>
            @if (currentFriendId && gift.purchased && gift.purchasedByName) {
            <p class="purchased-info">
              Purchased by {{ gift.purchasedByName }}
              @if (gift.purchasedAt) {
              <span class="purchased-date"> on {{ gift.purchasedAt | date:'mediumDate' }}</span>
              }
            </p>
            }
            <div class="gift-footer">
              <span class="price">${{ gift.price }}</span>
              <div class="action-buttons">
                @if (currentFriendId) {
                <button (click)="togglePurchased(gift)"
                  [matTooltip]="canTogglePurchase(gift) ? (gift.purchased ? 'Mark as not purchased' : 'Mark as purchased') : 'Only the person who purchased this can unmark it'"
                  mat-icon-button [color]="gift.purchased ? 'primary' : 'default'" [disabled]="!canTogglePurchase(gift)"
                  class="cart-button">
                  <mat-icon>{{ gift.purchased ? 'remove_shopping_cart' : 'add_shopping_cart' }}</mat-icon>
                </button>
                } @else {
                <button (click)="openEditGiftDialog(gift)" mat-icon-button color="primary" matTooltip="Edit gift"
                  class="edit-button">
                  <mat-icon>edit</mat-icon>
                </button>
                <button (click)="deleteGift(gift.id)" mat-icon-button color="warn" matTooltip="Delete gift"
                  class="delete-button">
                  <mat-icon>delete</mat-icon>
                </button>
                }
              </div>
            </div>
          </div>
        </div>
      </mat-card>
    </div>
    }
  </div>
  } @else {
  <div class="list-container">
    @for (gift of gifts; track gift.id) {
    <mat-card class="gift-card list-item">
      @if (currentFriendId && gift.purchased) {
      <div class="purchased-badge">
        <mat-icon>shopping_cart</mat-icon>
        <span>Purchased</span>
      </div>
      }
      <div class="card-content">
        <div class="image-container">
          <img [src]="gift.imageUrl" [alt]="gift.name" class="gift-image">
        </div>
        <div class="gift-details">
          <div class="gift-header">
            <h3 class="gift-name">{{ gift.name }}</h3>
          </div>
          <p class="gift-description">{{ gift.description }}</p>
          @if (currentFriendId && gift.purchased && gift.purchasedByName) {
          <p class="purchased-info">
            Purchased by {{ gift.purchasedByName }}
            @if (gift.purchasedAt) {
            <span class="purchased-date"> on {{ gift.purchasedAt | date:'mediumDate' }}</span>
            }
          </p>
          }
          <div class="gift-footer">
            <span class="price">${{ gift.price }}</span>
            <div class="action-buttons">
              @if (currentFriendId) {
              <button (click)="togglePurchased(gift)"
                [matTooltip]="canTogglePurchase(gift) ? (gift.purchased ? 'Mark as not purchased' : 'Mark as purchased') : 'Only the person who purchased this can unmark it'"
                mat-icon-button [color]="gift.purchased ? 'primary' : 'default'" [disabled]="!canTogglePurchase(gift)"
                class="cart-button">
                <mat-icon>{{ gift.purchased ? 'remove_shopping_cart' : 'add_shopping_cart' }}</mat-icon>
              </button>
              } @else {
              <button (click)="openEditGiftDialog(gift)" mat-icon-button color="primary" matTooltip="Edit gift"
                class="edit-button">
                <mat-icon>edit</mat-icon>
              </button>
              <button (click)="deleteGift(gift.id)" mat-icon-button color="warn" matTooltip="Delete gift"
                class="delete-button">
                <mat-icon>delete</mat-icon>
              </button>
              }
            </div>
          </div>
        </div>
      </div>
    </mat-card>
    }
  </div>
  }
  }

  @if (!currentFriendId) {
  <button (click)="openAddGiftDialog()" class="add-gift-fab" color="primary" mat-fab matTooltip="Add new gift">
    <mat-icon>add</mat-icon>
  </button>
  }
</div>